@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix owl:  <http://www.w3.org/2002/07/owl#> .
@prefix dct:  <http://purl.org/dc/terms/> .
@prefix csvw: <http://www.w3.org/ns/csvw#> .

@base <https://w3id.org/csvw-dp> .
@prefix dp: <https://w3id.org/csvw-dp#> .


# =====================================================
# Ontology declaration
# =====================================================

dp:
    a owl:Ontology ;

    # --- Identity & versioning ---
    dct:title "CSVW Differential Privacy Extension Vocabulary" ;
    owl:versionInfo "0.1.0" ;
    owl:versionIRI <https://w3id.org/csvw-dp/0.1.0> ;

    # --- Description ---
    dct:description """
    A vocabulary extending W3C CSV on the Web metadata with explicit
    differential privacy modeling primitives, including contribution bounds,
    partition constraints, and derived column semantics.
    """ ;

    # --- Authorship & governance ---
    dct:creator <https://github.com/dscc-admin-ch> ;
    dct:publisher <https://github.com/dscc-admin-ch> ;
    dct:created "2026-01-30"^^xsd:date ;

    # --- Licensing ---
    dct:license <https://creativecommons.org/licenses/by/4.0/> ;

    # --- Technical context ---
    owl:imports <http://www.w3.org/ns/csvw> ;

    # --- Documentation ---
    rdfs:seeAlso <https://github.com/dscc-admin-ch/csvw-dp> .


# =====================================================
# CLASSES
# =====================================================

dp:Groupable a rdfs:Class ;
    rdfs:label "Groupable" ;
    rdfs:comment "Abstract class for entities that can be used to form groups (partitions) for differential privacy analysis." .

dp:ColumnGroup a rdfs:Class ;
    rdfs:subClassOf dp:Groupable ;
    rdfs:label "ColumnGroup" ;
    rdfs:comment "Represents a grouping key formed by two or more columns. Useful for multi-column DP aggregation bounds." .

dp:DerivedColumn a rdfs:Class ;
    rdfs:subClassOf csvw:Column ,
        [ a owl:Restriction ;
          owl:onProperty dp:derivedFrom ;
          owl:minCardinality 1
        ] ,
        [ a owl:Restriction ;
          owl:onProperty csvw:virtual ;
          owl:hasValue true
        ] .
    rdfs:label "DerivedColumn" ;
    rdfs:comment "Columns computed from other columns; not physically present in raw CSV (virtual column)." .

# =====================================================
# TABLE-LEVEL PROPERTIES
# =====================================================

dp:maxTableLength a rdf:Property ;
    rdfs:domain csvw:Table ;
    rdfs:range xsd:positiveInteger ;
    rdfs:label "maxTableLength" ;
    rdfs:comment "Upper bound on total rows to avoid overflow or numerical instability during aggregation." .

dp:tableLength a rdf:Property ;
    rdfs:domain csvw:Table ;
    rdfs:range xsd:positiveInteger ;
    rdfs:label "tableLength" ;
    rdfs:comment "Number of rows in table, if known." .

dp:maxContributions a rdf:Property ;
    rdfs:domain csvw:Table ;
    rdfs:range xsd:positiveInteger ;
    rdfs:label "maxContributions" ;
    rdfs:comment "Maximum number of rows contributed by a single individual." .

# =====================================================
# COLUMN-LEVEL PROPERTIES
# =====================================================

dp:privacyId a rdf:Property ;
    rdfs:domain csvw:Column ;
    rdfs:range xsd:boolean ;
    rdfs:label "privacyId" ;
    rdfs:comment "True if the column identifies individuals/units for differential privacy." .

dp:nullableProportion a rdf:Property ;
    rdfs:domain csvw:Column ;
    rdfs:range xsd:decimal ;
    rdfs:label "nullableProportion" ;
    rdfs:comment "Fraction of values that are null (0.0â€“1.0), used for approximate modeling." .

dp:publicPartitions a rdf:Property ;
    rdfs:domain csvw:Column ;
    rdfs:range rdf:List ;
    rdfs:label "publicPartitions" ;
    rdfs:comment "Declared set of partition keys when grouping values are publicly known. Can include missing (NaN) values." .

# =====================================================
# DP AGGREGATION BOUNDS (COLUMNS AND GROUPS)
# =====================================================

dp:maxPartitionLength a rdf:Property ;
    rdfs:domain dp:Groupable ;
    rdfs:range xsd:positiveInteger ;
    rdfs:label "maxPartitionLength" ;
    rdfs:comment "Maximum size of any group when grouping by the column(s)." .

dp:maxNumPartitions a rdf:Property ;
    rdfs:domain dp:Groupable ;
    rdfs:range xsd:positiveInteger ;
    rdfs:label "maxNumPartitions" ;
    rdfs:comment "Maximum number of distinct groups (partition keys). May differ from length of dp:publicPartitions." .

dp:maxInfluencedPartitions a rdf:Property ;
    rdfs:domain dp:Groupable ;
    rdfs:range xsd:positiveInteger ;
    rdfs:label "maxInfluencedPartitions" ;
    rdfs:comment "Maximum number of groups a person may contribute to. Maps to the l0 DP metric." .

dp:maxPartitionContribution a rdf:Property ;
    rdfs:domain dp:Groupable ;
    rdfs:range xsd:positiveInteger ;
    rdfs:label "maxPartitionContribution" ;
    rdfs:comment "Maximum number of contributions inside one partition. Maps to the l_inf DP metric." .

dp:columns a rdf:Property ;
    rdfs:domain dp:ColumnGroup ;
    rdfs:range rdf:List ;
    rdfs:label "columns" ;
    rdfs:comment "List of columns that collectively define a multi-column group. Must contain at least 2 columns." .

# =====================================================
# DERIVED COLUMN PROPERTIES
# =====================================================

csvw:virtual a rdf:Property ;
    rdfs:domain csvw:Column ;
    rdfs:range xsd:boolean ;
    rdfs:label "virtual" ;
    rdfs:comment "True if column is derived/preprocessed and not physically present in the CSV file." .

dp:derivedFrom a rdf:Property ;
    rdfs:domain dp:DerivedColumn ;
    rdfs:range rdf:List ;
    rdfs:label "derivedFrom" ;
    rdfs:comment "Source column(s) used to compute this column. Always a list, even if length = 1." .

dp:transformationType a rdf:Property ;
    rdfs:domain dp:DerivedColumn ;
    rdfs:range xsd:string ;
    rdfs:label "transformationType" ;
    rdfs:comment "Identifier of the preprocessing operation, e.g., normalize, bucketize, oneHotEncode." .

dp:transformationArguments a rdf:Property ;
    rdfs:domain dp:DerivedColumn ;
    rdfs:range rdf:List ;
    rdfs:label "transformationArguments" ;
    rdfs:comment "Parameters of the transformation, expressed as a list of strings or values." .

# =====================================================
# Transformation Catalog (placeholder)
# =====================================================
dp:TransformationType a rdfs:Class ;
    rdfs:label "TransformationType" ;
    rdfs:comment "Placeholder for controlled vocabulary of transformations (normalize, bin, clip, truncate, onehot, etc.)" .
